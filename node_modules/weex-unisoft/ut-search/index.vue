<!-- Created by 赵官林 on 20/12/22. -->
<!--搜索框-->
<template>
  <div :style="contentStyle" @click="click">
    <div class="container">
      <div class="bg" :style="inputStyle">
        <slot name="left">
          <ut-icon class="input-left" name="search" :iconStyle="{fontSize: '36px'}"></ut-icon>
        </slot>
        <input class="input" 
              type="text"
              ref="utsearchinput"
              :value="value" 
              :placeholder="placeholder"
              :hideDoneButtoniOS="true"
              :autofocus="fullscreen"
              return-key-type="search"
              @return="search"
              @input="change"
              @focus="focus"
              @blur="blur"/>
      </div>
      <slot name="right" v-if="cancelShow">
        <text class="input-right" @click="cancel">取消</text>
      </slot>
    </div>
    <slot>
    </slot>
  </div>
</template>

<script>

import UtIcon from "../ut-icon";
import Utils from "../utils";

export default {
  name: 'utSearch',
  components: {UtIcon},
  model:{
    prop:'value',
    event:'change'
  },
  props:{
    value: {
      type: [String, Number],
      default: ''
    },
    placeholder: {
      type: String,
      default: ''
    },
    backgroundColor: {
      type: String,
      default: '#ffffff'
    },
    inputBgColor: {
      type: String,
      default: '#f2f2f2'
    },
    radius: {
      type: Boolean,
      default: true
    },
    fullscreen: {
      type: Boolean,
      default: false
    }
  },
  data() {
    return {
      cancelShow: false
    }
  },
  computed: {
    statusBarHeight() {
      if (Utils.isIPhoneX()) {
        return 66;
      } else if (Utils.isIOS()) {
        return 40;
      } else {
        return 0;
      }
    },
    inputStyle() {
      return {
        backgroundColor: (this.fullscreen?'#ffffff':this.inputBgColor), 
        borderRadius: this.radius?'32px;':'',
      }
    },
    contentStyle() {
      if (this.cancelShow && this.fullscreen) {
        return {
          position: 'fixed',
          left: '0px',
          right: '0px',
          top: '0px',
          bottom: '0px',
          paddingTop: `${this.statusBarHeight+10}px`,
          backgroundColor: 'rgba(240, 240, 240, 0.95)',
        };
      } else {
        return {
          position: 'relative',
          paddingTop: 0,
          backgroundColor: this.backgroundColor,
        };
      }
    }
  },
  methods: {
    search(e) {
      this.$emit('search', e.value);
    },
    change(e) {
      this.$emit('change', e.value);
    },
    cancel() {
      this.cancelShow = false;
      this.$refs.utsearchinput.blur();
      this.$emit('change', '');
      this.$emit('cancel');
    },
    focus() {
      this.$emit('focus');
      this.cancelShow = true;
    },
    blur() {
      if (!this.fullscreen) {
        this.cancelShow = false;
      }
    },
    click() {
      this.$refs.utsearchinput.blur();
    }
  }
}
</script>

<style scoped>
  .container {flex-direction: row; align-items: center; margin: 20px;}
  .bg {flex-direction: row; align-items: center; flex: 1;}
  .input-left {width: 64px; text-align: center; color: #666; margin-left: 10px;}
  .input-right {font-size: 32px; font-weight: bold; text-align: center; color: #333; margin-left: 20px;}
  .input {font-size: 28px; height: 64px; line-height: 64px; flex: 1; color: #333;}
</style>