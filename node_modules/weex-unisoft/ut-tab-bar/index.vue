<!-- Created by 赵官林 on 20/6/17. -->
<!--底部标签栏.-->
<template>
  <div class="wxc-tab-page">
    <div class="tab-page-wrap" :style="{width: `${750*tabTitles.length}px`,paddingBottom: fullScreen?'0px':((_tabStyles.height + (isIPhoneX ? 40 : 0))+'px')}" ref="tab-page-wrap">
      <div ref="tab-container" class="tab-container">
        <slot></slot>
      </div>
    </div>

    <div class="tab-title-list" :style="{ backgroundColor: _tabStyles.bgColor, height: (_tabStyles.height + (isIPhoneX ? 40 : 0))+'px',paddingBottom:isIPhoneX?'40px':'0'}">
      <div class="title-item" v-for="(v,index) in tabTitles" :key="index"
           @click="setPage(index,v.url)"
           :style="{ width: _tabStyles.width +'px', height: _tabStyles.height +'px', backgroundColor: currentPage == index ? _tabStyles.activeBgColor : 'rgba(255, 255, 255, 0)' }"
           :accessible="true"
           :aria-label="`${v.title?v.title:'标签'+index}`">

        <image :src="currentPage == index ? v.activeIcon : v.icon"
               v-if="titleType === 'icon' && !titleUseSlot"
               :style="{ width: _tabStyles.iconWidth + 'px', height:_tabStyles.iconHeight+'px'}"></image>

        <text v-if="titleType === 'iconFont' && v.codePoint && !titleUseSlot"
              :style="{fontFamily: _tabStyles.fontFamily,fontSize: _tabStyles.iconFontSize+'px', marginBottom:_tabStyles.iconFontMarginBottom ? (_tabStyles.iconFontMarginBottom +'px') : '8px', color: currentPage == index ? _tabStyles.activeIconFontColor : _tabStyles.iconFontColor}">{{currentPage == index ? (v.activeCodePoint||v.codePoint) : v.codePoint}}</text>
        <text v-if="!titleUseSlot"
          :style="{ fontSize: _tabStyles.fontSize+'px', fontWeight: (currentPage == index && _tabStyles.isActiveTitleBold)? 'bold' : 'normal', color: currentPage == index ? _tabStyles.activeTitleColor : _tabStyles.titleColor, paddingLeft:_tabStyles.textPaddingLeft+'px', paddingRight:_tabStyles.textPaddingRight+'px'}"
          class="tab-text">{{v.title}}</text>
        <div class="desc-tag" v-if="v.badge && !titleUseSlot">
          <text class="desc-text">{{v.badge}}</text>
        </div>
        <div v-if="v.dot && !v.badge && !titleUseSlot" class="dot"></div>
        <slot :name="`tab-title-${index}`" v-if="titleUseSlot"></slot>
      </div>
    </div>
  </div>
</template>

<style scoped>
  .wxc-tab-page {
    background-color: white;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  .tab-title-list {
    flex-direction: row;
    justify-content: space-around;
    border-top-width: 2px;
    border-top-color: #f2f2f2;
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.95;
  }

  .title-item {
    justify-content: center;
    align-items: center;
    border-bottom-style: solid;
  }

  .tab-page-wrap {
    width: 750px;
    flex: 1;
    overflow: hidden;
  }

  .tab-container {
    flex: 1;
    flex-direction: row;
    /* position: absolute; */
  }

  .tab-text {
    lines: 1;
    text-overflow: ellipsis;
  }

  .desc-tag {
    position: absolute;
    top: 10px;
    right: 20px;
    border-bottom-right-radius: 14px;
    border-bottom-left-radius: 0;
    border-top-left-radius: 14px;
    border-top-right-radius: 14px;
    background-color: #FF5E00;
    height: 26px;
    align-items: center;
    justify-content: center;
    padding-left: 6px;
    padding-right: 6px;
  }

  .dot {
    width: 12px;
    height: 12px;
    border-bottom-right-radius: 12px;
    border-bottom-left-radius: 12px;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    position: absolute;
    top: 10px;
    right: 40px;
    background-color: #FF5E00;
  }

  .desc-text {
    font-size: 18px;
    color: #ffffff;
  }

</style>

<script>
  const animation = weex.requireModule('animation');
  import Utils from "../utils";
  export default {
    props: {
      tabTitles: {
        type: Array,
        default: () => ([])
      },
      tabStyles: {
        type: Object,
        default: () => ({})
      },
      titleType: {
        type: String,
        default: 'icon'
      },
      titleUseSlot: {
        type: Boolean,
        default: false
      },
      duration: {
        type: [Number, String],
        default: 0
      },
      timingFunction: {
        type: String,
        default: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
      },
      fullScreen: {
        type: Boolean,
        default: false
      }
    },
    data: () => ({
      currentPage: 0,
      translateX: 0
    }),
    computed: {
      isIPhoneX() {
        return Utils.isIPhoneX();
      },
      _tabStyles() {
        let style = {
          bgColor: '#FFFFFF',
          titleColor: '#333333',
          activeTitleColor: '#40a704',
          activeBgColor: 'rgba(255, 255, 255, 0)',
          activeIconFontColor: '#40a704',
          iconFontColor: '#666666',
          isActiveTitleBold: true,
          iconWidth: 70,
          iconHeight: 70,
          width: 250,
          height: 120,
          fontSize: 24,
          textPaddingLeft: 10,
          textPaddingRight: 10,
          fontFamily: '',
          iconFontSize: 42
        }
        for (const key in this.tabStyles) {
          if (Object.hasOwnProperty.call(this.tabStyles, key)) {
            style[key] = this.tabStyles[key];
          }
        }
        return style;
      }
    },
    methods: {
      next () {
        let page = this.currentPage;
        if (page < this.tabTitles.length - 1) {
          page++;
        }
        this.setPage(page);
      },
      prev () {
        let page = this.currentPage;
        if (page > 0) {
          page--;
        }
        this.setPage(page);
      },
      setPage (page, url = null, animated = true) {
        this.currentPage = page;
        this._animateTransformX(page, animated);
        this.$emit('tabSelected', { page });
      },
      _animateTransformX (page, animated) {
        const { duration, timingFunction } = this;
        const computedDur = animated ? duration : 0.00001;
        const containerEl = this.$refs[`tab-container`];
        const dist = page * 750;
        animation.transition(containerEl, {
          styles: {
            transform: `translateX(${-dist}px)`
          },
          duration: computedDur,
          timingFunction,
          delay: 0
        }, () => {
        });
      }
    }
  };
</script>