<!-- Created by 赵官林 on 20/6/17. -->
<!--输入框input扩展（细分number为int与float）-->
<template>
    <div @click="click" class="border-color" :style="borderStyle">
        <div :class="['cell', center&&'cell-center', bottom&&'cell-bottom']">
          <slot name="icon">
              <ut-icon v-if="icon" class="cell-icon" :name="icon" size="32" :iconStyle="iconStyle"></ut-icon>
          </slot>
          <div class="cell-content">
            <div :class="['cell-boday', 'cell-content', (type == 'textarea')&&'cell-top']">
              <text v-if="required" class="cell-required">*</text>
              <slot name="title">
                <text v-if="title" class="cell-title" :style="titleStyle">{{title}}</text>
              </slot>
              <template v-if="!vertical">
                <div v-if="type == 'textarea'" class="border-color cell-content" :style="inputBorderStyle">
                  <textarea class="cell-textarea" :style="valueStyle" v-bind="$attrs" :value="value" v-on="inputListeners"/>
                </div>
                <template v-else>
                  <input class="cell-value" :style="valueStyle" :type="inputType" v-bind="$attrs" :value="value" v-on="inputListeners"/>
                  <ut-icon v-if="showRightIcon" class="cell-icon-right" :name="_rightIcon" size="32" :iconStyle="rightIconStyle" @click="clear" />
                </template>
              </template>
            </div>
            <template v-if="vertical">
              <div v-if="type == 'textarea'" class="border-color cell-span" :style="inputBorderStyle">
                <textarea class="cell-textarea" :style="valueStyle" v-bind="$attrs" :value="value" v-on="inputListeners"/>
              </div>
              <div class="cell-boday cell-span" v-else>
                <input class="cell-value" :style="valueStyle" :type="inputType" v-bind="$attrs" :value="value" v-on="inputListeners"/>
                <ut-icon v-if="showRightIcon" class="cell-icon-right" :name="_rightIcon" size="32" :iconStyle="rightIconStyle" @click="clear" />
              </div>
            </template>
            <text v-if="$attrs.maxlength&&showWordLimit" class="cell-limit">{{value.length}}/{{$attrs.maxlength}}</text>
            <slot name="label">
              <text v-if="label" class="cell-label" :style="labelStyle">{{label}}</text>
            </slot>
          </div>
          <slot name="right-icon">
            <ut-icon v-if="isLink" class="cell-icon-right" :name="arrow" size="32" :iconStyle="rightIconStyle"></ut-icon>
          </slot>
        </div>
    </div>
</template>

<script>

import UtIcon from "../ut-icon";

export default {
  name: 'utInput',
  components: {UtIcon},
  inheritAttrs: false,
  props:{
      type: {
        type: String,
        default: 'text'
      },//输入类型扩展：int、float
      icon: {
          type: String,
          default: ''
      },
      rightIcon: {
          type: String,
          default: ''
      },
      title: {
          type: String,
          default: ''
      },
      label: {
          type: String,
          default: ''
      },
      value: {
          type: String,
          default: ''
      },
      arrowDirection: {
          type: String,
          default: 'right'//left up down
      },
      required: {
          type: Boolean,
          default: false
      },
      clearable: {
          type: Boolean,
          default: false
      },
      showWordLimit: {
          type: Boolean,
          default: false
      },
      vertical: {
          type: Boolean,
          default: false
      },
      isLink: {
          type: Boolean,
          default: false
      },
      center: {
        type: Boolean,
        default: false
      },
      bottom: {
        type: Boolean,
        default: false
      },
      border: {
        type: Boolean,
        default: false
      },
      borderTop: {
        type: Boolean,
        default: false
      },
      borderBottom: {
        type: Boolean,
        default: false
      },
      inputBorder: {
        type: Boolean,
        default: false
      },
      iconStyle: {
        type: Object,
        default: () => ({color:'#999999'})
      },
      rightIconStyle: {
        type: Object,
        default: () => ({color:'#999999'})
      },
      titleStyle: {
        type: Object,
        default: () => ({})
      },
      valueStyle: {
        type: Object,
        default: () => ({})
      },
      labelStyle: {
        type: Object,
        default: () => ({})
      }
  },
  data() {
    return {
      isInput: false
    }
  },
  computed: {
    borderStyle() {
      return {
        borderTopWidth: (this.borderTop||this.border?1:0)+'px',
        borderBottomWidth: (this.borderBottom||this.border?1:0)+'px'
      }
    },
    inputBorderStyle() {
      return {
          padding: this.inputBorder?'10px':'0px',
          borderRadius: '10px',
          borderWidth: this.inputBorder?'1px':'0px'
      }
    },
    arrow() {
       switch (this.arrowDirection) {
         case 'left':
           return 'back'
         case 'up':
           return 'up2'
         case 'down':
           return 'down2'
         default:
           return 'arrow';
       }
    },
    _rightIcon() {
        if (this.rightIcon) {
          return this.rightIcon;
        }
        if (this.clearable) {
          return 'close2';
        }
        return this.rightIcon;
    },
    showRightIcon() {
      if (this.clearable) {
        return this.isInput && this.value;
      } else {
        return this._rightIcon;
      }
    },
    inputType: function () {
      let type = this.type.toLowerCase();
      if (type === 'int' || type === 'float') {
        return 'number';
      }
      return type;
    },
    inputListeners: function () {
      var vm = this;
      return Object.assign({}, this.$listeners, {
        focus:function (event) {
          vm.isInput = true;
          vm.$emit('focus', event.value);
        },
        blur:function (event) {
          vm.isInput = false;
          vm.$emit('focus', event.value);
        },
        input: function (event) {
          vm.$emit('input', event.value);
        },
        change: function (event) {
          let type = vm.type.toLowerCase();
          let value = event.value;
          if (type === 'int' || type === 'float') {
            let values = event.value.match(/\d+\.*\d*/) || [];
            if (values.length > 0) {
              if (type === 'int') {
                value = parseInt(values[0]);
              } else {
                value = parseFloat(values[0]);
              }
            } else {
              value = '';
            }
          }
          vm.$emit('input', value);
          vm.$emit('change', value);
        }
      });
    }
  },
  methods: {
      click() {
        this.$emit('click');
      },
      clear() {
        this.$emit('input', '');
      }
  }
}
</script>

<style scoped>
 .border-color {
  border-color: #E6E6E6;
}
.cell-required {
  color: red;
  font-size: 32px;
  margin-right: 10px;
  margin-top: 10px;
}
.cell-icon {
  line-height: 44px;
  width: 44px;
  margin-right: 10px;
}
.cell-icon-right {
  line-height: 44px;
  margin-left: 10px;
}
.cell {
  flex: 1;
  background-color: #ffffff;
  padding: 20px 30px;
  flex-direction: row;
  align-items:flex-start;
}
.cell-center {
  align-items: center;
}
.cell-bottom {
  align-items: flex-end;
}
.cell-top {
  align-items:flex-start;
}
.cell-boday {
  flex-direction: row;
  align-items: center;
}
.cell-content {
  flex: 1;
}
.cell-title {
  color: #333333;
  font-size: 28px;
  width: 200px;
  text-overflow: ellipsis;
  lines: 1;
}
.cell-value {
  color: #666666;
  font-size: 28px;
  flex: 1;
  text-overflow: ellipsis;
  height: 48px; 
  line-height: 48px;
  padding-left: 10px;
}
.cell-textarea {
  color: #666666;
  font-size: 28px;
  flex: 1;
  text-overflow: ellipsis;
  padding: 1px;
}
.cell-label {
  color: #999999;
  font-size: 26px;
  flex: 1;
  text-overflow: ellipsis;
  margin-top: 10px;
}
.cell-limit {
  color: #666666;
  font-size: 26px;
  flex: 1;
  text-overflow: ellipsis;
  margin-top: 10px;
  margin-right: 10px;
  text-align: right;
}
.cell-span {
  margin-top: 10px;
}
</style>